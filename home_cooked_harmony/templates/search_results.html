{% extends "base.html" %} {% load static %} {% block body_style %}
background-image: url('{% static 'assets/cuisine-pattern.png' %}'); {%endblock%}
{% block content %}

<div class="container mt-5">
  {% for message in messages %} {% if message.tags == 'success' %}
  <div class="alert alert-success text-center">{{ message }}</div>
  {% endif %} {% endfor %}
  <div class="row">
    <div class="col-lg-8">
      <!-- Post content-->
      {% for post in posts %}
      <article class="art-bg rounded mb-4">
        <div class="row">
          <!-- Post image -->
          <div class="col-md-3 d-flex justify-content-center img-preview">
            <a href="{% url 'post_details' slug=post.slug %}">
              {% if post.image and post.image.url %}
              <img
                class="rounded my-3"
                src="{{ post.image.url }}"
                alt="{{ post.title }}"
              />
              {% else %}
              <img
                class="rounded my-3"
                src="{% static 'assets/food_placeholder.png' %}"
                alt="{{ post.title }}"
              />
              {% endif %}
            </a>
          </div>
          <!-- Post preview -->
          <div class="col-md-6">
            <header class="mb-2">
              <a href="{% url 'post_details' slug=post.slug %}">
                <h1 class="fw-bolder mb-1 post-title">
                  {{ post.title|truncatewords:25 }}
                </h1>
              </a>
              <!-- Post meta content-->
              <div class="text-muted fst-italic mb-2">
                Posted on {{ post.date|date:'d/m/Y' }}, by {{post.author}}
                <!-- Badges -->
              <span class="badge text-decoration-none link-light text-end">Preparation Time: {{ post.preptime }} minutes</span>
              <span class="badge text-decoration-none link-light text-end">Servings: {{ post.servings }} people</span>
            
              </div>
            </header>
            <section>
              <a href="{% url 'post_details' slug=post.slug %}">
                <p class="mb-2 post-description">
                  {{ post.description|striptags|safe|truncatewords:100 }}
                </p>
              </a>
            </section>
          </div>
          <!-- Edit and Delete buttons -->
          {% if request.user.is_authenticated and request.user == post.author %}
          <div
            class="col-md-2 d-flex flex-column justify-content-center align-items-end"
          >
            <form method="POST" action="{% url 'edit_post' post.id %}">
              {% csrf_token %}
              <button type="submit" class="btn mb-2 edit-delete">
                <i class="fas fa-pencil-alt me-2 fa-lg"></i>
              </button>
            </form>
            <form method="POST" action="{% url 'delete_post' post.id %}">
              {% csrf_token %}
              <button type="submit" id="delete-button" class="btn edit-delete">
                <i class="fas fa-trash-alt me-2 fa-lg"></i>
              </button>
            </form>
          </div>
          {% endif %}
          <!-- Simple like display -->
          <span class="like-counter likes-preview"
            >{{ post.likes.all.count }} {% if post.likes.all.count == 1 %} like
            {% else %} likes {% endif %}
          </span>
        </div>
      </article>
      {% endfor %}
      <!-- Pagination buttons -->
      {% if is_paginated %}
      <nav aria-label="Page navigation">
        <p class="text-center mb-3">
          <span class="badge pagination-badge"
            >Page {{ page_obj.number }} of
            {{page_obj.paginator.num_pages}}</span
          >
        </p>
        <ul class="pagination justify-content-center">
          {% if page_obj.has_previous %}
          <li>
            <a
              href="?page={{ page_obj.previous_page_number }}"
              class="page-link pagination-btn"
              >&laquo; PREV</a
            >
          </li>
          {% endif %} {% if page_obj.has_next %}
          <li>
            <a
              href="?page={{ page_obj.next_page_number }}"
              class="page-link pagination-btn"
            >
              NEXT &raquo;</a
            >
          </li>
          {% endif %}
        </ul>
      </nav>
      {% endif %}
    </div>
    <!-- Side widgets-->
    <div class="col-lg-4">
      <!-- Search widget-->
      <div class="card mb-4">
        <div class="card-header card-header-bg fw-bold">Search</div>
        <div class="card-body card-widget">
          <form method="GET" action="{% url 'search' %}">
            <div class="input-group">
              <input
                class="form-control"
                type="text"
                name="q"
                placeholder="Enter search term..."
                aria-label="Enter search term..."
                aria-describedby="button-search"
              />
              <button class="btn btn-search" id="button-search" type="submit">
                Go!
              </button>
            </div>
          </form>
          <div class="mt-3">
            <h5>Search by amount of servings:</h5>
            <ul>
              {% for serving in servings %}
              <li>
                <a
                  href="{% url 'search_by_serving' serving=serving %} "
                  class="search-term"
                  >{{ serving }} people</a
                >
              </li>
              {% endfor %}
            </ul>
            <h5>Search by preparation time:</h5>
            <ul>
              {% for prep in preptime %}
              <li>
                <a
                  href="{% url 'search_by_preptime' preptime=prep %}"
                  class="search-term"
                  >{{ prep }} minutes</a
                >
              </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
